

\section{The need to combine resolution and precision}

Traditional data reduction techniques work in either resolution space or precision space
exclusively. They truncate either the last few levels in a multi-resolution representation of the
data, or the last few low-ordered bits, but rarely both. Our aim in this section is to show that
significant gain can be achieved when one combines both dimensions of data reduction. To do so, we
construct and compare different ways to order the bits of a data set so that bits that have higher
impact on the error (in regards to a metric of interest) appear earlier. We call each ordering a
\emph{stream} of bits. The idea is that, if the data is streamed to a receiver using a bit ordering
that is optimized for a certain metric, the receiver would be able to perform analysis tasks
pertaining to that metric as soon as possible, while incurring minimal error.

Streams are not constructed from raw data bits, but from a representation in which every bit can be
associated with a resolution level and a bit plane. We use the CDF5/3 wavelet transform [CITE] to
decompose the domain into resolution levels (also known as subbands). To handle precision in a
unified way, we quantize the resulting wavelet coefficients to $16$-bit signed integers, which are
then converted to negabinary form [CITE]. In each subband, negabinary coefficients are grouped into
groups of $g \times g$ in 2D, and each group is divided into \emph{chunks}. A chunk contains a
single bit plane of all coefficients in the group. For performance reasons, we do not stream one bit
at a time, but always one chunk at a time (a typical chunk size used in this paper is $4 \times 4 =
16$ bits). This constraint is reasonable because in practice, data is almost never read or written
bit-by-bit.

Of the streams to be compared, one proceeds strictly from coarser to finer resolution levels
(\emph{by level}), one proceeds stricly from higher-ordered to lower-ordered bit planes (\emph{by
bit plane}), and one combines resolution and precision (\emph{by wavelet norm}). The \emph{by
levels} stream is designed to represent the way data is read in traditional multi-resolution
techniques such as those based on subsampling [CITE], octrees [CITE], or wavelets [CITE]. The
\emph{by bit plane} stream represents techniques that truncate data in precision such as zfp [CITE].
The \emph{by wavelet norm} sort chunks in decreasing order of $\norm{W_l}_2 \times 2^b$, where $l$
and $b$ are a chunk's subband and bit plane, and $W_l$ is the wavelet basis function at subband $l$.
These three streams are data-independent. We also include in the comparison two data-dependent
streams, namely \emph{resolution-adaptive} and \emph{fully adaptive}. In the
\emph{resolution-adaptive} stream, chunks are ordered so as to minimize peak-signal-to-noise ratio
(PSNR [CITE]), with one constraint: every wavelet coefficients must come in full precision (in other
words, chunks of the same group are streamed together). The \emph{fully adaptive} stream orders
chunks to minimize PSNR the same way, but without any constraints. Both streams are constructed
using the greedy algorithm discussed in Section [REF].

For each stream, everytime a chunk is received, the data is reconstructed at full resolution using
only the chunks received so far. An error value is then computed, depending on the metric in used
(e.g., PSNR, histogram error, isocontour error, etc). For the $512 \times 512$, double-precision
data set \emph{Magnetic} [REF], Figure \ref{fig:motivation} compares the five streams in
PSNR relative to the original (unquantized) data. We note that for this particular comparison,
chunks containing only leading zero bits are removed for all streams, to mimic the effect of entropy
compression in practice.

\begin{figure}
	\centering
	\subcaptionbox{Magnetic}
	{\includegraphics[width=0.44\linewidth]{img/motivation/magnetic-motivation.pdf}}
	\subcaptionbox{Boiler-O2}
	{\includegraphics[width=0.44\linewidth]{img/motivation/boiler-oh-motivation.pdf}}
	\subcaptionbox{Flame-OH}
	{\includegraphics[width=0.44\linewidth]{img/motivation/kflame-oh-motivation.pdf}}
	\subcaptionbox{Miranda-diffusivity}
	{\includegraphics[width=0.44\linewidth]{img/motivation/miranda-diffusivity-motivation.pdf}}
	\caption{PSNR comparison of streams that are by resolution exclusively (\emph{by level} and
	\emph{resolution-adaptive}), by precision exclusively (\emph{by bit plane}), and by both combined
	(\emph{by wavelet norm} and \emph{fully adaptive}). Higher is better. A 20 dB increase in PSNR
	approximately translates to one more decimal digit of accuracy.}
	\label{fig:motivation}
\end{figure}

It can be seen from Figure \ref{fig:motivation} that the streams that combine resolution and
precision (\emph{by wavelet norm} and \emph{fullly adaptive}) perform the best, either among the
data-independent streams, or the data-dependent ones. This is true across all four data sets shown,
and for all other data sets in our experiments. The \emph{fully adaptive} stream, can be thought of
as an empirical upper bound on how well any stream of the same data can perform in terms of PSNR. Of
the data-independent streams, \emph{by bit plane}approximates \emph{by wavelet norm}  well, but this
is true only when the error metric is PSNR. In the next section, we show that because of its greater
flexibility, the \emph{by wavelet norm} stream outperforms \emph{by bit plane} by a large margin
when it comes to computing an accurate histogram.

% \begin{figure*}[!htb]
% 	\includegraphics[width=0.33\linewidth]{img/dataset/miranda-viscosity.png}
% 	\includegraphics[width=0.33\linewidth]{img/dataset/magnetic.png}
% 	\includegraphics[width=0.33\linewidth]{img/dataset/euler2d.png}
% 	\caption{Left to right: Miranda viscosity field, magnetic reconnection, Euler 2d sharp front}
% 	\label{fig:datasets}
% \end{figure*}

% \begin{figure}[htb!]
% 	\centering
% 	\subcaptionbox{without skip leading zeros}
% 	{\includegraphics[width=0.4\linewidth]{img/independent/rmse-miranda-viscosity}}
% 	\subcaptionbox{with skip leading zeros}
% 	{\includegraphics[width=0.4\linewidth]{img/skip-zeros/rmse-miranda-viscosity}}
% 	\caption {PSNR comparison between three streams: by bit-plane, by level, and by wavelet norm}
% 	\label{fig:psnr_traditional_vs_by_norm_viscosity}
% \end{figure}

% In the supplement materials, we show the same plot for the following datasets:
% \begin{enumerate}
%   \item Miranda viscosity (smooth and uniform)
%   \item Kingsnake (noisy and sparse)
%   \item Magnetic (tiny narrow lines)
%   \item Euler 2D (sharp front)
%   \item Enzo u (wide range)
% \end{enumerate}

\section{The need for task-specific streams}
From the above two figures we have shown that it is worthwhile to look into streams that are not
either simply by bit-plane or by levels. But it is also important that we look into the metric (or
the analysis task) at hand to decide what bits to stream. We have shown one example where a stream
that works well for one metric (PSNR) does not work well for other metrics (isocontour and
histogram) in the previous section. Here we show an example where a PSNR-optimized stream performs
poorly compared to an isocontour stream and histogram stream in respective metrics.

Here we show that for isocontour extraction, and for histogram computation, we are better off with other streams.

\textbf{Define} Stream S8 = greedily-optimized for histogram
Figure: histogram error for the following streams: S1, S2, S3, S6, and S8. This figure shows that among the static streams (S1, S2 and S3), the S2 stream performs the best for histogram, in contrast to the case for PSNR above. Comparing the two data-dependent streams S6 and S8, we note that S8 performs better than S6, implying that simply optimizing for PSNR does not result in the best stream for histogram.

\begin{figure}[htb!]
	\centering
	\subcaptionbox{without skip leading zeros}
	{\includegraphics[width=0.4\linewidth]{img/independent/normalized/histogram-miranda-viscosity}}
	\subcaptionbox{with skip leading zeros}
	{\includegraphics[width=0.4\linewidth]{img/skip-zeros/histogram-miranda-viscosity}}
	\caption {Histogram with earth mover distance (EMD) comparison between three streams: by bit-plane, by level, and by wavelet norm}
	\label{fig:histogram_traditional_vs_by_norm_viscosity}
\end{figure}

\begin{figure}[htb!]
	\centering
	\subcaptionbox{without skip leading zeros}
	{\includegraphics[width=0.4\linewidth]{img/independent/normalized/isocontour-miranda-viscosity}}
	\subcaptionbox{with skip leading zeros}
	{\includegraphics[width=0.4\linewidth]{img/skip-zeros/isocontour-miranda-viscosity}}
	\caption {Isocontour ($h = 0.0634$) comparison between three streams: by bit-plane, by level, and by wavelet norm}
	\label{fig:isocontour_traditional_vs_by_norm_viscosity}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.8\linewidth]{resources/isocontour-error-by-bit-plane-viscosity.png}
  \caption {By bit-plane isocontour comparison versus no constraints for viscosity, isoval=-0.005}
  \label{fig:by_bit_plane_isocontour}
\end{figure}
